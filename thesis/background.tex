\chapter{Background}
\label{ch:background}

In this chapter, we delineate the principles of contemporary naval communications, emphasizing the characteristics and deficiencies of prevailing standards (NMEA).
The subsequent discussion will address the necessity for "software-defined networking" and the innovative technologies underpinning network administration, EBPF and AFXDP.


\section{Naval Networks}\label{sec:naval_networking_and_nmea}

A naval network, otherwise referred to as an \textbf{integrated shipboard communication system} is a sophisticated and meticulously organized system designed to facilitate communication, data exchange, and operational coordination whithin subsystems and devices on the vessel. 
Given the numerous elements that contribute to the ship's apparatus, such as navigation systems, sensors, monitoring systems, and combat-management systems, our focus will be directed exclusively towards the communication limb that directly interests our final goal.

\subsection{Communication systems}
Communication systems facilitate seamless communication of the vessel both internally and externally ensuring the continuous exchange of data.
The field of external communication can be subdivided into three primary categories :

\begin{itemize}
    \item\textbf{Command and Control (C2)},for long-range capabilities such as communication with shore-based command centers, other ships and aircrafts
    \item\textbf{Tactical Coordination}, for short-to-medium range communication which are critical for coordination and emergency communications
    \item\textbf{Emergency Communication},for real time data exchange among various components allowing coordinated operations among ships, aircrafts and ground forces
\end{itemize}

External side communication's capstone can be identified in the usage of the Satellite Communication (SATCOM) protocol that enables beyond-line-of-sight (BLOS) data exchange providing global, high-bandwidth, and secure connectivity. However, it is part of a broader ecosystem that includes radio communication, tactical data links, and underwater communication systems.\\
Internal communication, on the other hand, although it comprises crew coordination systems the main body consists of devices that provide a unified picture among navigation, propulsion, combat, and management environments. Vessels are designed to establish an informational circulatory system within them that consists of a physical apparatus composed of various components such as switches, routers, gateways, and servers. The flow of information within it falls into five distinct categories: 

\begin{itemize}
    \item\textbf{Navigation and Situational Awareness}, data transmitted over the network and integrated into the Combat Management System, providing a real-time operational picture
    \item\textbf{Threat Detection and Response}, data signaling potential threats coming from the sensoring systems
    \item\textbf{Engine Monitoring and Control}, data allowing the crew to monitor and optimize the ship's propulsion and power systems
    \item\textbf{Crew Communication}, intercom system's data to coordinate crew actions during missions
    \item\textbf{Cybersecurity Monitoring}, cybersecurity systems data that ensure integrity and safety of the ship
\end{itemize}

\subsection{NMEA}

Given the wide range of the aforementioned messages in the early years of 1980 the \textbf{National Marine Electronics Association (NMEA)} introduced the first kind of protocol to standardize communication for marine electronics.
Since its inception, the protocol has evolved significantly to accommodate advancements in technology and the expanding needs of different industries.

\subsubsection*{NMEA 0183}
The protocol underwent a series of modifications, beginning with the 0180 and 0182 versions. However, these initial implementations were swiftly discarded in favor of the subsequent iteration, the 0183. This new version's adoption as the primary standard for serial communications can be attributed to its simplicity and comprehensive functionality, providing the vessel's components a complete overview of other one's status through simple text.

This standard utilizes a rudimentary ASCII serial communications protocol, which delineates a method where data are transmitted in a \textbf{sentence} from a single \textbf{talker} to multiple \textbf{listeners} concurrently. The protocol enables a talker to engage in a unidirectional conversation with an almost limitless number of listeners by employing intermediate expanders, and it facilitates communication between multiple sensors and a singular port through the use of multiplexers.  

Although the protocol stipulates the use of RS-422 for electrical transport, a de facto standard has emerged in which sentences are \textbf{encapsulated in UDP datagrams} and \textbf{transmitted over IP networks}.

\paragraph{Message structure}
\leavevmode\newline\\
    All messages must be composed of printable ASCII characters between \textit{0x20} (space) to \textit{0x7e} (tilde) including a set of special characters that define the syntax
    
\begin{tabularx}{\textwidth}{|>{\hsize=0.5\hsize}X|>{\hsize=0.5\hsize}X|>{\hsize=1\hsize}X|}
  \hline
  \multicolumn{3}{|c|}{\textbf{Syntax characters}} \\ \hline
  ASCII & HEX & USE \\ \hline
  \textless CR\textgreater  &  0x0d   & Carriage return        \\ \hline
  \textless LF\textgreater   & 0x0a    & Line feed, end delimiter       \\ \hline
  !    & 0x21   &   Start of encapsulation sentence delimiter   \\ \hline
  \textdollar     & 0x24   & Start delimiter      \\ \hline
  *    & 0x2a    & Checksum delimiter     \\ \hline
  ,    & 0x2c   & Field delimiter       \\ \hline
  \textbackslash     & 0x5c   & TAG block delimiter        \\ \hline
  \textasciicircum    & 0x5e     & Code delimiter for HEX representation of ISO/IEC 8859-1 (ASCII) characters     \\ \hline
  \textasciitilde     & 0x7e    & Reserved       \\ \hline
\end{tabularx}

\leavevmode\newline\\
Moreover, adherence to established syntax rules is imperative for the purpose of ensuring compliance with the protocol, in particular :

\begin{itemize}
    \item Messages have a maximum length of 82 characters, including the \textdollar \ or ! starting character and the ending \textless LF\textgreater
    \item The start character for each message can be either a \textdollar (For conventional field delimited messages) or ! (for messages that have special encapsulation in them)
    \item The next five characters identify the \textbf{Talker Id} (two characters) and the \textbf{Sentence Type} (three characters)
    \item All data fields that follow are comma-delimited
    \item Where data is unavailable, the corresponding field remains blank (it contains no character before the next delimiter
    \item The first character that immediately follows the last data field character is an asterisk, but it is only included if a checksum is supplied
    \item The asterisk is immediately followed by a checksum represented as a two-digit hexadecimal number. The checksum is the bitwise exclusive OR of ASCII codes of all characters between the \textdollar \ and *, not inclusive.
    \item \textless CR\textgreater \textless LF\textgreater \ ends the message
\end{itemize}

The following is a list of the most common messages that appeared in the early days of this technology, constituting the first kind of standardized communication:
\leavevmode\newline\

\begin{tabularx}{\textwidth}{|>{\hsize=0.75\hsize}X|>{\hsize=1.25\hsize}X|}
  \hline
  \multicolumn{2}{|c|}{\textbf{NMEA 0183 Common Sentences}} \\ \hline
  Sentence Type & Description \\ \hline
   \textdollar Talker ID+GGA  & Global Positioning System Fixed Data         \\ \hline
   \textdollar Talker ID+GLL    & Geographic Positionâ€”Latitude and Longitude       \\ \hline
  \textdollar Talker ID+GSA   &   GNSS DOP and active satellites    \\ \hline
   \textdollar Talker ID+GSV  & GNSS satellites in view      \\ \hline
   \textdollar Talker ID+RMC   & Recommended minimum specific GPS data     \\ \hline
   \textdollar Talker ID+VTG   & Course over ground and ground speed      \\ \hline
\end{tabularx}

\paragraph{Protocol security}

\leavevmode\newline\\

The protocol's conception predates the conceptualization of vehicle hacking, thus lacking any inherent security measures to protect network information flows from potential attacks.
To date, the research community has conducted only a limited number of studies on the security of network marine protocols. Moreover, there is a paucity of research on risk analysis for this type of communication.

As is the case with other networking protocols, marine protocols are susceptible to malicious attacks and unintentional human errors. It is incumbent upon manufacturers to consider the extended Confidentiality, Integrity, and Availability (CIA) model, which encompasses Authentication, Authorization, and Non-repudiation from the creation to implementation and maintenance of network device firmware. 

As of the present date, only naive solutions have been implemented in order to address these primary security concerns :

\begin{itemize}

    \item\textbf{Confidentiality} : Due to the limitation of bandwidth in many marine network protocols, encryption mechanisms are not implemented. Consequently, the predominant approach to ensure confidentiality for these systems is primarily through access control.
    
    \item\textbf{Integrity} : Vessels generate substantial surges in network traffic, which often surpasses the bandwidth capacity of the ship. This phenomenon can result in service disruptions and latency as various services compete for bandwidth. One proposed solution to this challenge is the implementation of a master device in conjunction with multiple remote devices. In instances where a high-priority bandwidth requirement is identified, a remote device can be temporarily allocated to an auxiliary channel, thereby facilitating the management of network traffic.
    
    \item\textbf{Availability} : The majority of maritime communication protocols are designed to support slow transfer speeds. Therefore, the protection for availability is contingent upon the hardware specification and configuration, allowing for data transfer at the maximum data rate of the protocol. In the context of critical systems that necessitate uninterrupted accessibility, the implementation of hardware redundancy and backup mechanisms becomes imperative.

    \item\textbf{Authentication} : A select number of shipping protocols incorporate optional authentication mechanisms that are not specialized for the protocols themselves. These include the Global Navigation Satellite System (GNSS) and systems adopted from vehicular networks. Consequently, under theory, these protocols possess the potential to be adapted to support authentication for marine networks; however, this functionality is not currently available.

    \item\textbf{Authorization} : A considerable number of protocols incorporate a form of an ID tag to identify the communication nodes, along with their privileges, as well as access rights, inside a network. However, in the absence of adequate inspection mechanisms, a malicious device can potentially generate its own ID with a high level of authorization, thereby circumventing access controls and gaining unauthorized access to sensitive information. 

    \item\textbf{Non-Repudiation} : This concern has witnessed a marked rise in prominence, particularly in the context of forensics and legal challenges. Non-repudiation is poised to assume greater significance; however, at present, no non-repudiation technique has been implemented in any substantial manner.
    
\end{itemize}

As the protocol undergoes continuous development and enhancement, \textbf{theoretical analyses} were conducted to evaluate the current state of data exchange security in response to prevalent attacks. The objective of this endeavor was to identify vulnerabilities that could be exploited by an attacker to compromise the protocol.
The subsequent list of attacks is not intended to be exhaustive; rather, it is designed to illustrate the most critical violations that can be perpetrated in networks that utilize the protocol:

\begin{itemize}
    \item\textbf{Denial of Service (DoS)}: targets the availability of data
    \item\textbf{Spoofing}: targets the integrity of data.
    \item\textbf{Packet sniffing}: targets the confidentiality of data.
    \item\textbf{Replay/Man-in-the-Middle (MITM)}: targets both confidentiality and integrity of data.
\end{itemize}

It is important to note that the NMEA 0183 protocol does not incorporate any mechanisms for authentication, encryption, or validation. The absence of security measures inherent to the protocol renders it vulnerable to any of the aforementioned attack if utilized effectively by an adversary

\leavevmode\newline\\

\begin{tabularx}{\textwidth}{|>{\hsize=0.75\hsize}X|>{\hsize=1.25\hsize}X|}
  \hline
  \multicolumn{2}{|c|}{\textbf{Attacks against the NMEA 0183 protocol}} \\ \hline
  Attack & Methodology \\ \hline
    Denial of Service & NMEA 0183 supports a baud rate of 4800 (9600 bits/s). This makes a DoS attack potentially effective against any devices using this protocol depending on the means through which data is transferred to an application \\ \hline
    Spoofing/Packet Sniffing   & Spoofing and sniffing has been shown to be trivial against the standard using simple traffic simulation software     \\ \hline
    Replay/Man-in-the-Middle &  Leveraging software that that intercepts and manipulates data exchanged modifiying critical missions' informations such as coordinates coming from sensor devices  \\ \hline
\end{tabularx}

\subsubsection{NMEA 2000}
The fourth iteration of the protocol resulted in a more advanced implementation, characterized by more sophisticated structural choices that increased performance. Regrettably, the security standards remained unaltered.

\paragraph{Key changes}
\leavevmode\newline

The backbone of this new version's enhancements can be identified in the standard communication being based on the \textbf{Controller Area Network (CAN)} Bus protocol.
CAN protocol utilizes a priority-driven and message-based architecture capable of operating at either 512 Kbps or 128 Kbps.

Each device that transmits CAN Bus signals is considered a node with its own priority level and during transmission, nodes continuously check the signal on the bus comparing it
with the signal they are transmitting. If a mismatch occurs, an error is raised and the internal error counter is incremented to prevent having broken nodes continuously flooding the network. The right of a node to raise errors can be disabled depending on the value of these counter granting that communication over CAN Bus is reliable.

The advent of this novel information flow structure has enabled the transmission of data messages at elevated speeds as data frames characterized by the incorporation of robust error checking mechanisms, confirmed frame delivery, and guaranteed latency times.
Additionally, the transmission of information as binary messages, as opposed to ASCII text, facilitates more efficient and secure data exchange.
This was done mantaining a relatively simple message structure organized as follows 
\begin{itemize}
    \item\textbf{GN (Parameter Group Number)} :Defines the type of data being transmitted
    \item\textbf{SPN (Suspect Parameter Number)}: Identifies specific data fields within a PGN
    \item\textbf{Data Length}: Specifies the length of the data in bytes
\end{itemize}

This implementation choice was made also in light of the following key advantages concerning the physical characteristics of this type of communication: 

\begin{itemize}
    \item\textbf{Simple and Cheap}: Components communicate via a single CAN system instead of via direct complex analog signal lines reducing errors, weight, wiring, and costs.
    \item\textbf{Fully centralized architecture} : Only one point of entry is set to communicate with all network components enabling central diagnostics, data logging, and configuration.
    \item\textbf{Extremely Robus and Efficient} : the system is robust towards electric disturbances and electromagnetic interference - ideal for safety-critical applications
    AN frames are prioritized by ID numbers. The top priority data gets immediate bus access, without causing interruption of other frames.
\end{itemize}

\leavevmode\newline\\

\begin{figure}[H]
	\centering
    \includegraphics[scale=0.23]{thesis/images/nmea2000_can.png}
	\caption{NMEA2000 Protocol with CAN Bus communication}
    \label{fig:nmea2000can}
\end{figure}

\paragraph{Protocol Security}
\leavevmode\newline

The NMEA 2000 standard did not incorporate any inherent security features related to confidentiality, authentication, authorization, or non-repudiation, which were not present in the previous versions.
The implementation of controls for potential attack vectors is delegated to nodes, which utilize their own \textbf{application-specific} protocols operating on top of the marine network.
Therefore, an analysis of the protocol itself, absent any top-level software add-on, reveals that the vulnerabilities identified in previous iterations have reemerged, albeit with modified attack methodologies.

\leavevmode\newline\\

\begin{tabularx}{\textwidth}{|>{\hsize=0.75\hsize}X|>{\hsize=1.25\hsize}X|}
  \hline
  \multicolumn{2}{|c|}{\textbf{Attacks against the NMEA 2000 protocol}} \\ \hline
  Attack & Methodology \\ \hline
    Denial of Service & Leveraging the protocol's low-bandwidth design malicious devices or poorly configured ones could produce a large amount of traffic without raising errors on the main bus message channel, preventing other devices from communicating
studies \\ \hline
    Spoofing & Exploiting situations where the Parameter Group Number (PGN) used to identify the sending node is copied and used by a malicious device. This imposes more problems since PGN is also used to indicate the priority of messages. \\ \hline
    Packet Sniffing & Since NMEA 2000 operates on a single broadcast domain where all nodes on the message channel receive all messages. Since the responsibility to discern which messages to discard as unneeded is delegated to nodes passive sniffing of messages is a trivial task, assuming physical access is possible.   \\ \hline
    Replay/Man-in-the-Middle & Considering the protocol's broadcast principle, an inline device could be placed between the target node and the rest of the channel (bus). This malicious inline device would be able to pass along messages from either the target node or the rest of the channel in either direction. \\ \hline
\end{tabularx}

\leavevmode\newline

\subsubsection{Considerations over the standard}
NMEA 0183 and NMEA 2000 have achieved widespread acceptance among manufacturers and maritime agencies worldwide, receiving frequent updates and support.\\ Attempting to modify these standards would necessitate years of adjustments, aiming to align with current hardware infrastructures that are utilized on a daily basis by a wide range of essential services.\\ However, as previously emphasized, the absence of security measures necessitates the urgent development of a compatible and transparent solution for the naval ecosystem.

\section{Software Defined Networking - SDN}
The urgent pursuit of alternatives that would seamlessly integrate with current naval systems' architecture has prompted the consideration of Software Defined Networking (SDN).

This technology can be defined as an approach to networking that uses software-based controllers or application programming interfaces (APIs) to communicate with underlying hardware infrastructure and direct traffic on a network.\\
Contrary to state-of-the-art solutions which utilize dedicated hardware devices (e.g., routers and switches), SDN possesses the capability to create and control a virtual network or to manage a traditional hardware configuration through the use of software.

This new way of indending data flow differs also from network virtualization where techniques where different virtual networks are segmented within a single physical network or to connect devices on different networks are connected to create a single virtual one.

In contrast, software-defined networking enables a new way of controlling the routing of data packets through a centralized server while leaving physical and virtual configurations unaltered.

\subsection{Operational Process}
The technology's paradigm relies on software rather than hardware for its operations. This inherent characteristic bestows upon it a superior degree of flexibility when compared with traditional networking methodologies.

With SDN administrators exercise comprehensive control over the network via a single pane of glass, modifying configuration settings, allocating resources, and augmenting network capacity.

This degree of flexibility enables the three fundamental components of SDN to be situated in disparate physical locations:
\begin{itemize}
    \item\textbf{Applications} which communicate resource requests or information about the network as a whole
    \item\textbf{Controllers} which use the information from applications to decide how to route data packets
    \item\textbf{Networking devices}, which receive information from the controller about where to move the data
\end{itemize}

In some cases additional software components may be embedded in either the software or the hardware to take over the responsibilities of physical switches and consolidate their functions into a single, intelligent switch.
The switch checks the integrity of both the data packets and their virtual machine destinations and moves the packets along.

Since software is decoupled from the hardware


